17. FRONT-END SETUP

    1. Setup

        NOPE
            npx create-react-app airbnb-react --template=typescript
            npm i @chakra-ui/react @emotion/react @emotion/styled framer-motion

        USE THIS INSTEAD
            npx create-react-app my-app --template @chakra-ui/typescript

        cd airbnb-react && code .
        
        src > DELETE
            only apptsx, indextsx, react-app-env left

        index >
            DEL import reportWebVitals from './reportWebVitals';
                import './index.css';
                reportWebVitals()

        app >
            DEL import logo from './logo.svg';
                import './App.css';
                return only <div/>

        npm i react-router-dom

        index >
            surrond app with ChakraProvider

        >npm run start

        app > 
            <Text fontSize={"2xl"} color={"red.600"}>
            hi
            </Text>

    2. Router Setup

    Root acts as the base URL for website styles
    Outlet allows a specific page to be rendered depending on the route

        src > components.Root.tsx >
            (rfce)
            import { Outlet } from 'react-router-dom';

            function Root() {
            return (
                <div>
                    Root
                    <Outlet />
                </div>
            )
            }

            export default Root

    This is done in router.tsx, where a router variable referencing Root
    as the element, and various routes as the children is created. But first,
    some things need to change.
        
        DELETE APP.tsx
        index >
            replace <App/> with <RouterProvider/>
            replace import { App } from "./App"
                with import { RouterProvider } from "react-router-dom"

    Now create a routes folder and rfce 2 testing routes (Home.tsx & Users.tsx)
    Then create the router.

        src > router.tsx >
            import { createBrowserRouter } from 'react-router-dom';
            import Root from './components/Root';

            const router = createBrowserRouter([{
                path: "/",
                element: <Root />,
                children: [
                    {
                        path: "",
                        element: <Home />
                    },
                    {
                        path: "users",
                        element: <Users />
                    }
                ]
            }]);

            export default router;

    Navigating to each route (http://localhost:3000/ & http://localhost:3000/users)
    the text is different

    3. Not Found page

    DELETE USers.tsx
    create NotFound.tsx in routes
    add to router, before children variable and after path variable as errorElement
        errorElement: <NotFound />,
    navigate to non-existent page - works

    NotFound
        import { Button, Heading, Text, VStack } from '@chakra-ui/react'
        import { Link } from 'react-router-dom';
        function NotFound() {
            return (
                <VStack
                    justifyContent={"center"}
                    minH="100vh"
                    background={"gray.100"}
                >
                    <Heading>Page not found.</Heading>
                    <Text>It seems you are lost</Text>
                    <Link to='/'>
                        <Button
                            variant={"link"}
                            // ghost, solid, link, outline
                            colorScheme={"twitter"}
                        // twitter, red
                        >Go home &rarr;</Button>
                    </Link>
                </VStack>
            );
        }

        export default NotFound

    4. Chakra Tour

        chakra-ui.com/docs/components

-------------------------------------------------------------------------

18. CHAKRA UI

    1. Header

    npm i react-icons
    default theme chakra page
    rem is based on the body font-size 
        if fs is 16px 1rem is 16px

    icons are not chakra components, so need to be enclosed with a chakra box
    to change color

    Root.tsx>
        import { Box, Button, HStack } from '@chakra-ui/react';
        import { FaAirbnb } from 'react-icons/fa';
        import { Outlet } from 'react-router-dom';

        function Root() {
        return (
            <Box>
            <HStack py={"5"} px={10} borderBottomWidth={1}
                justifyContent="space-between">
                <Box color={"red.500"}>
                <FaAirbnb size={48} />
                </Box>
                <HStack spacing={"2rem"}>
                <Button>Login</Button>
                <Button colorScheme={"red"}>Signup</Button>
                </HStack>
            </HStack>
            <Outlet />
            </Box>
        )
        }

        export default Root

    2. Login Modal

        <Modal isOpen={isOpen} onClose={onClose}>
            <ModalOverlay />
            <ModalContent>
                <ModalHeader>Login</ModalHeader>
                <ModalCloseButton />
                <ModalBody>
                <VStack>
                    <InputGroup>
                    <InputLeftElement children={
                        <Box color={"gray.500"}>
                        <FaUserNinja />
                        </Box>} />
                    <Input
                        placeholder='Username'
                        variant={"filled"} />
                    </InputGroup>
                    <InputGroup>
                    <InputLeftElement children={
                        <Box color={"gray.500"}>
                        <FaLock />
                        </Box>} />
                    <Input
                        placeholder='Password'
                        variant={"filled"} />
                    </InputGroup>
                </VStack>

                </ModalBody>
                <ModalFooter>
                <Button colorScheme={"red"} w={"100%"}>Login</Button>
                </ModalFooter>
            </ModalContent>

            </Modal>

    3. Signup Modal

        Separate Compontents>
            Header.tsx
                SocialLogin.tsx
                    LoginModal.tsx
                    SignupModal.tsx

        use useDisclosure to control each Modal
            renaming isOpen, onOpen, onClose using :
                eg. isOpen:isLoginOpen

    4. Dark Mode

        src>theme.ts
            import { extendTheme, type ThemeConfig } from "@chakra-ui/react";

            const config: ThemeConfig = {
                initialColorMode: "light",
                useSystemColorMode: false,
            }

            const theme = extendTheme({ config })
            export default theme;

        index.tsx > pass theme to ChakraProvider
            import { ChakraProvider, ColorModeScript } from "@chakra-ui/react"
            import theme from "./theme"

            <ChakraProvider theme={theme}>
                <ColorModeScript initialColorMode={theme.config.initialColorMode} />

            ...
        
            ctrl + shift + j > application > local storage > delete key & restart server
            updates based on theme.js theme (light, dark)

        Header >
            const { colorMode, toggleColorMode } = useColorMode();

            <IconButton
                onClick={toggleColorMode}
                variant={"ghost"}
                aria-label='Toggle Dark Mode'
                icon={colorMode === "light" ? <FaMoon /> : <FaSun />} />

        ^ long way
        > short way > [useColorModeValue(varforlight, varfordark)]
            const colorToggleICon = useColorModeValue(<FaMoon />, <FaSun />)
                
                ...
                icon={colorToggleICon} />


        Wrap components in LightMode or DarkMode to force stylings for that Mode 
            regardless of current Mode
                <LightMode>
                    <Button colorScheme={"red"}
                        onClick={onSignupOpen}
                    >Signup</Button>
                </LightMode>

        Animation >
            Wrap component to animate (iconbutton) with AnimatorPresence & motion.div
            with exitBeforeEnter & initial={false}

            import { AnimatePresence, motion } from 'framer-motion';

                <AnimatePresence exitBeforeEnter initial={false}>
                    <motion.div
                        style={{ display: 'inline-block' }}
                        key={useColorModeValue('light', 'dark')}
                        initial={{ y: -20, opacity: 0 }}
                        animate={{ y: 0, opacity: 1 }}
                        exit={{ y: 20, opacity: 0 }}
                        transition={{ duration: 0.1 }}
                    >
                        COMPONENT
                    </motion.div>
                </AnimatePresence> 

    5. Rooms Grid

        Home >
            Create Grid component with boxes inside 
<Grid
            columnGap={4}
            rowGap={8}
            templateColumns={{
                sm: "1fr",
                md: "1fr 1fr",
                lg: "repeat(3, 1fr)",
                xl: "repeat(4, 1fr)",
                "2xl": "repeat(4, 1fr)",
            }}
            px={{
                sm: 10,
                lg: 40,
            }}
            mt={10}
        ><Boxes......></Grid>

    6. Responsive Design

            templateColumns={{
                sm: "1fr",
                md: "1fr 1fr",
                lg: "repeat(2, 1fr)",
                xl: "repeat(3, 1fr)",
                "2xl": "repeat(4, 1fr)",
            }}

            fix heading from hstack to stack to control direction depending on screen size>
                <Stack py={5}
                px={{
                    base: 10,
                    lg: 40,
                }}
                alignItems="center"
                spacing={{
                    sm: 4,
                    md: 0,
                }}
                borderBottomWidth={1}
                justifyContent={"space-between"}
                direction={{
                    sm: "column",
                    md: "row",
                }}>


      Add custom breakpoints to theme.ts
      const breakpoints = {
            sm: '320px',
            md: '768px',
            lg: '960px',
            xl: '1200px',
            '2xl': '1536',
            '3xl': '1800',
            '4xl': '2266',
            '5xl': '2655',
        }          
    const theme = extendTheme({ config, breakpoints })


    7. Skeletons

        import { Box, HStack, Skeleton, SkeletonCircle, SkeletonText, Spacer } from "@chakra-ui/react"

        function SkeletonRoom() {
            return (
                <Box>
                    <Skeleton height={{ sm: 315, lg: 290 }} rounded="3xl" mb={3} />
                    <HStack mb={-0.5} w={"100%"}>
                        <SkeletonText noOfLines={1} w={"70%"} />
                        <Spacer />
                        <SkeletonCircle py={1} px={7} />
                    </HStack>
                    <SkeletonText noOfLines={1} w={"50%"} mb={3} />
                    <SkeletonText noOfLines={1} w={"25%"} mt={4} />
                </Box>
            )
        }

        export default SkeletonRoom


    _hover={{color:"red}}

-------------------------------------------------------------------------

19. REACT QUERY / TANSTACK QUERY

    1. Manual Fetching

        Trying 
            useEffect(() => {
                fetch("http://127.0.0.1:8000/api/v1/rooms/");
            }, [])

        Will result in a CORS Error
            if django-cors-headers not installed and configured
                
                BACKEND
                poetry add django-cors-headers
                
                THIRD_PARTY_APPS = [... "corsheaders", ...]
                MIDDLEWARE = [..., "corsheaders.middleware.CorsMiddleware",]
                CORS_ALLOWED_ORIGINS = ["http://localhost:3000",]


        NOT RECOMENDED FOR LARGER APPS
            Testing isLoading with fetchRooms hook >

                const [isLoading, setIsLoading] = useState(true);
                const [rooms, setRooms] = useState();
                const fetchRooms = async () => {
                    const res = await fetch("http://127.0.0.1:8000/api/v1/rooms/");
                    const json = await res.json();
                    setRooms(json);
                    setIsLoading(false);
                }
                useEffect(() => {
                    fetchRooms();
                }, [])

                ...

                {isLoading ? (
                    <>
                        <RoomSkeleton />
                        <RoomSkeleton />
                    </>
                ) : <Room />}

        RECOMMENDED FOR LARGER APPS (REACT/TANSTACK QUERY) SEE 3


    2. Recap
        Room
            interface IRoomProps {
                name: string;
                imageURL: string;
                city: string;
                country: string;
                price: number;
                rating: number;
            }

            function Room({ name, imageURL, rating, city, country, price }: IRoomProps) {

        Home

            interface IPhoto {
                pk: string;
                file: string;
                description: string;
            }

            interface IRoom {
                pk: number;
                name: string;
                city: string;
                country: string;
                price: number;
                is_owner: boolean;
                rating: number;
                photos: IPhoto[];
            }

            function Home() {
                const [isLoading, setIsLoading] = useState(true);
                const [rooms, setRooms] = useState<IRoom[]>([]);
                ...
                ...
                {rooms.map(room =>
                    <Room
                        key={room.pk}
                        name={room.name}
                        price={room.price}
                        rating={room.rating}
                        city={room.city}
                        country={room.country}
                        imageURL={
                            room.photos[0] == undefined ?
                                "https://a0.muscache.com/im/pictures/c2da931b-1f28-434c-8f99-d82f816a2ec6.jpg?im_w=720" :
                                room.photos[0].file == undefined ?
                                    "data:image/jpeg;base64,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" :
                                    room.photos[0].file
                        }

    3. React Query / Tanstack

        Assists by not refetching already present data through caching

        npm i @tanstack/react-query

        index >
            import {QueryClient, QueryClientProvider} from '@tanstack/react-query';

            const client = new QueryClient();
            root.render(
            <React.StrictMode>
                <QueryClientProvider client={client}>
                <ChakraProvider theme={theme}>
                    <ColorModeScript initialColorMode={theme.config.initialColorMode} />
                    <RouterProvider router={router} />
                </ChakraProvider>
                </QueryClientProvider>
            </React.StrictMode>,
            )


        api.ts >
            const BASE_URL = "http://127.0.0.1:8000/api/v1"

            export const getRooms = async () => {
                const res = await fetch(`${BASE_URL}/rooms/`);
                const json = await res.json();
                return json;
            }

        Home >
            DEL ALL CODE ABOVE RETURN AND BELOW Home
            REPLACE WITH
            const {isLoading, data} = useQuery<IRoom[]>(["rooms"], getRooms);

            ....
            {data?.map(room =>
            ...

    4. Axios

        npm i axios
        Adapter on top of fetch

        api >
            GUT
            import axios from "axios";

            const instance = axios.create({
                baseURL: "http://127.0.0.1:8000/api/v1/",
            });

            export const getRooms = () => instance.get("rooms/").then(res => res.data);

    5. Room Detail

        Home > 
            add pk to room mapping
            add pk to IRoom

        Room >
            add pk to IRoomProps and props for Room

        routes > RoomDetail rfce
            import { useParams } from "react-router-dom";
            import { useQuery } from "@tanstack/react-query";
            import { getRoomDetail } from "../api";

            function RoomDetail() {
                const { roomPk } = useParams();
                const { isLoading, data } = useQuery([`room:${roomPk}`], getRoomDetail)
                console.log(data);
                return (
                    <div>RoomDetail</div>
                )
            }

            export default RoomDetail

        router >
            children = [
                ...
                {
                    path:"rooms/:roomPk",
                    element:<RoomDetail/>,
                },
            ]

        backend > roomdetaiserializer > get_is_liked:
            if req.user.is_authenticated:
                ..code..
            return False

    6. Devtools and Query Keys

        REPLACES CONSOLE.LOG at bottom of page (left corner)

        npm i @tanstack/react-query-devtools 

        Add to Root below Outlet
            import {ReactQueryDevtools} from '@tanstack/react-query-devtools';
            ...
                <ReactQueryDevtools />

        api >
            import { QueryFunctionContext } from '@tanstack/react-query';
            
            ...

            export const getRoomDetail = ({ queryKey }: QueryFunctionContext) => {
                const [_, roomPk] = queryKey;
                return instance.get(`rooms/${roomPk}`).then(res => res.data);
            }

        RoomDetail >
            import { getRoomDetail } from "../api";

            function RoomDetail() {
                const { roomPk } = useParams();
                const { isLoading, data } = useQuery([`room`, roomPk], getRoomDetail)
                console.log(data);
                return (
                    <div>RoomDetail</div>
                )
            }

    7. Photos Grid

        CREATE A TYPE DECLARATION FILE
        src > types.d.ts
            export interface IRoomPhotoPhoto {
                pk: string;
                file: string;
                description: string;
            }

            export interface IRoomList {
                pk: number;
                name: string;
                country: string;
                city: string;
                price: number;
                rating: number;
                is_owner: boolean;
                photos: IRoomPhotoPhoto[];
            }

            export interface IRoomOwner {
                name: string;
                avatar: string;
                username: string;
            }

            export interface IAmenity {
                name: string;
                description: string;
            }

            export interface IRoomDetail extends IRoomList {
                created_at: string;
                updated_at: string;
                rooms: number;
                toilets: number;
                description: string;
                address: string;
                pet_friendly: true;
                kind: string;
                is_owner: boolean;
                is_liked: boolean;
                category: {
                    name: string;
                    kind: string;
                };
                owner: IRoomOwner;
                amenities: IAmenity[];
            }

        DELETE Interfaces and
        REPLACE IROOM with IROOMLIST and autoimport from above file
        in Home.tsx >
            ...
            const { isLoading, data } = useQuery<IRoomList[]>(["rooms"], getRooms);
            ...

        GridItem instead of Box inside of Grid to customise columnSpan, rowSpan
        Image objectFit={"cover"}

    8. Reviews & Conclusion

        types.d.ts >
            export interface IReview {
                payload: string;
                rating: number;
                user: IRoomOwner;
            }

        api >
            export const getRoomReviews = ({ queryKey }: QueryFunctionContext) => {
                const [_, roomPk] = queryKey;
                return instance.get(`rooms/${roomPk}/reviews`).then(res => res.data);
            }

        RoomDetail >
            ...
                <HStack mt={10} w={"40%"} justifyContent={"space-between"}>
                    <VStack alignItems={"flex-start"}>
                        <Skeleton isLoaded={!isLoading} h={"30px"}>
                            <Heading fontSize={'2xl'}>
                                House hosted by {data?.owner.username}
                            </Heading>
                        </Skeleton>
                        <Skeleton isLoaded={!isLoading} h={"30px"}>
                            <HStack justifyContent={"flex-start"} w={"100%"} >
                                <Text>{data?.toilets} toilet{data?.toilets == 1 ? "" : "s"}</Text>
                                <Text>|</Text>
                                <Text>{data?.rooms} room{data?.rooms == 1 ? "" : "s"}</Text>
                            </HStack>
                        </Skeleton>

                    </VStack>
                    <SkeletonCircle isLoaded={!isLoading} h="95px" w="95px">
                        <Avatar size={'xl'}
                            name={data?.owner.username}
                            src={data?.owner.profile_photo} />
                    </SkeletonCircle>

                </HStack>
                <Box mt={10}>
                    <Heading fontSize={'2xl'} mb={5}>
                        <Skeleton w={'40%'} isLoaded={!isLoading}>
                            <HStack>
                                <FaStar />
                                <Text>{data?.rating}</Text>
                                <Text fontSize={18}>|</Text>
                                <Text>{reviewsData?.length} review{reviewsData?.length === 1 ? "" : "s"}</Text>
                            </HStack>
                        </Skeleton>
                    </Heading>
                    <Container mx={"none"} maxW="container.lg" mt={35}>
                        <Grid templateColumns={"1fr 1fr"} gap={10}>
                            {reviewsData?.map((review, index) => (
                                <VStack key={index} alignItems={"flex-start"} spacing={0}>
                                    <HStack >
                                        <Avatar name={review.user.name}
                                            src={review.user.profile_photo}
                                            size={'md'}
                                        />
                                        <VStack alignItems={"flex-start"}>
                                            <Heading fontSize={'md'}>{review.user.username}</Heading>
                                            <HStack spacing={1}>
                                                <FaStar size={'12px'} />
                                                <Text>{review.rating}</Text>
                                            </HStack>
                                        </VStack>
                                    </HStack>
                                    <Text>{review.payload}</Text>

                                </VStack>
                            ))}
                        </Grid>
                    </Container>

                </Box>

-------------------------------------------------------------------------

20. AUTHENTICATION (FRONTEND)

    1. useUser

        Make header aware of authentication status (login | sign up if out, avatar if in)

        api >
            export const getMe = () => instance.get(`users/me`).then((response) => response.data);

        src.lib.useUser >
            import { useQuery } from "@tanstack/react-query";
            import { getMe } from "../api";

            export default function useUser() {
                const { isLoading, data, isError } = useQuery(["me"], getMe);
                return {
                    userLoading: isLoading,
                    userData: data,
                    isLoggedIn: !isError,
                }
            }

        tanstackquery will try multiple times on errors to get data before letting it fail
        this will cause buttons below to not show for a few secs(even when not logged in)
        This can be fixed by creating a config object in the usUser hook

        FROM THIS : 
            const { isLoading, data, isError } = useQuery(["me"], getMe);
        
        TO THIS:
            const { isLoading, data, isError } = useQuery(["me"], getMe, {
                retry: false,
            });
        
        Header >

            {!userLoading ? (
                !isLoggedIn ?
                    <>
                        <Button
                            onClick={onLoginOpen}
                        >
                            Login
                        </Button>
                        <LightMode>
                            <Button colorScheme={"red"}
                                onClick={onSignupOpen}
                            >
                                Signup
                            </Button>
                        </LightMode></> :
                    <Avatar size={'md'} />
            ) : null}


    2. Credentials

        Even if logged into Django admin panel, you will not be logged in on frontend
        This is due to cookies not being sent from the correct origin

        (localhost vs 127.0.0.1) 
        change to 127 in django 

            CORS_ALLOWED_ORIGINS = [
                "http://127.0.0.1:3000",
            ]

        also cookies are not sent by default by js, so we need to include them in
        axios instance 
        api >
            const instance = axios.create({
                baseURL: "http://127.0.0.1:8000/api/v1/",
                withCredentials: true,
            });

        however, django isnt prepared to receive these credentials, so we have to 
        enable it in settings >
            CORS_ALLOW_CREDENTIALS = True

        Header >
            ...
                <Avatar name={userData?.username} size={'md'} src={userData?.profile_photo} />
            ) : null}


        types >
            export interface IUser {
                last_login: string;
                username: string;
                email: string;
                date_joined: string;
                profile_photo: string;
                name: string;
                is_host: boolean;
                gender: string;
                language: string;
                currency: string;
            }

        lib.useUser >
            ...
            import { IUser } from "../types";

            export default function useUser() {
            const { isLoading, data, isError } = useQuery<IUser>(["me"], getMe, {
                retry: false,
            });
            ...

    3. Log Out

        Change Header Avatar section >
            <Menu>
                <MenuButton>
                    <Avatar name={userData?.username} size={'md'} src={userData?.profile_photo} />
                </MenuButton>
                <MenuList>
                    <MenuItem onClick={onLogOut}>Logout</MenuItem>
                </MenuList>
            </Menu>

        api >
            export const logOut = () => instance.post(`users/log-out`).then(res => res.data);

        Add to Header > 
            ...
            const onLogOut = async () => {
                const data = await logOut();
                console.log(data);
            }
            ...


        Toasts 

        Header >
            const toast = useToast();
            const onLogOut = async () => {
                const toastID = toast({
                    title: "Logging Out...",
                    description: "Goodbye :(",
                    status: "loading",
                    position: 'bottom-right'
                    // error, loading, info
                    // can also change color
                });
                // const data = await logOut();
                // console.log(data);
                setTimeout(() => {
                    toast.update(toastID, {
                        status: "success",
                        title: "Logged Out",
                        description: "Come back soon!",
                        duration: 2000
                    });
                }, 5000)
            }


    4. CSRF

        Django Settings >
            CSRF_TRUSTED_ORIGINS = ["http://127.0.0.1:3000"]

        Implement CSRF Token in headers of request (axios)
            npm i js-cookie
            npm i --save-dev @types/js-cookie
        
            api > 
                import Cookie from 'js-cookie';
                export const logOut = () => instance.post(`users/log-out`, null, {
                    headers: {
                        "X-CSRFToken": Cookie.get("csrftoken") || "",
                    }
                }).then(res => res.data);

        Works now,
        Ensure prof pic updates with query client
        Header >
            const toast = useToast();
            const queryClient = useQueryClient();
            const onLogOut = async () => {
                const toastID = toast({
                    title: "Logging Out...",
                    description: "Goodbye :(",
                    status: "loading",
                    position: 'bottom-right'
                    // error, loading, info
                    // can also change color
                });
                await logOut();
                queryClient.refetchQueries(['me']);
                setTimeout(() => {
                    toast.update(toastID, {
                        status: "success",
                        title: "Logged Out",
                        description: "Come back soon!",
                        duration: 2000
                    });
                }, 500)
            }

    5. Github Login

        OAuth
            User >>> Github >>> Displayed with Requesting info, if accepted >>>
            Our Website/confirm-gh?token=nj12i3bi >>> 
            Take Token >>> Django API >>> send GH token to Github API 
            >>> Receive information

            https://github.com/settings/applications/new > CREATE
            Note down Client ID & use in href of gh login with params of data u want

        SocialLogin
            <Button
                href='https://github.com/login/oauth/authorize?client_id=0fbb1ad5fb0e65e0fbde&scope=read:user,user:email'
                w={"100%"}
                as="a"
                leftIcon={<FaGithub />}
            >
                Continue with Github
            </Button>

    6. Github Code

        routes > GithubConfirm.tsx >
            import { Button, Heading, Spinner, Text, VStack } from '@chakra-ui/react'
            import { useEffect } from 'react';
            import { Link, useLocation } from 'react-router-dom';
            import { githubLogin } from '../api';

            export default function GithubConfirm() {
                const { search } = useLocation();
                const confirmLogin = async () => {
                    const params = new URLSearchParams(search);
                    const code = params.get("code");
                    if (code) {
                        await githubLogin(code);
                    }
                }
                useEffect(() => {
                    confirmLogin();
                }, []);
                return (
                    <VStack
                        justifyContent={"center"}
                        mt={40}
                    >
                        <Heading>Logging In...</Heading>
                        <Text>Please wait a moment.</Text>
                        <Spinner size={'lg'} />
                    </VStack>
                );
            }


        router >
            {
                path: "social",
                children: [
                    {
                        path: "github",
                        element: <GithubConfirm />,
                    }
                ],
            },

        api > 


        Django.user.urls > 
            path("github", views.GithubLogin.as_view()),

        users.views > 
            class GithubLogin(APIView):
                def post(self, req):
                    code = req.data.get("code")
                    print(code)
                    return Response()

    7. Access Token


        Django >
            poetry add requests
        
        users.views > 
            class GithubLogin(APIView):
                def post(self, req):
                    code = req.data.get("code")
                    access_token = requests.post(
                        f"https://github.com/login/oauth/access_token?code={code}&client_id=b99860fd6028f1114333&client_secret={settings.GH_SECRET}",
                        headers={"Accept": "application/json"},
                    )
                    access_token = access_token.json().get("access_token")
                    user_data = requests.get(
                        "https://api.github.com/user",
                        headers={
                            "Authorization": f"Bearer {access_token}",
                            "Accept": "application/json",
                        },
                    )
                    user_data = user_data.json()
                    return Response()


    8. Emails

        Add to above before return >
            class GithubLogin(APIView):
                def post(self, req):
                    try:
                        code = req.data.get("code")
                        access_token = requests.post(
                            f"https://github.com/login/oauth/access_token?code={code}&client_id=b99860fd6028f1114333&client_secret={settings.GH_SECRET}",
                            headers={"Accept": "application/json"},
                        )
                        access_token = access_token.json().get("access_token")
                        user_data = requests.get(
                            "https://api.github.com/user",
                            headers={
                                "Authorization": f"Bearer {access_token}",
                                "Accept": "application/json",
                            },
                        )
                        user_data = user_data.json()
                        user_emails = requests.get(
                            "https://api.github.com/user/emails",
                            headers={
                                "Authorization": f"Bearer {access_token}",
                                "Accept": "application/json",
                            },
                        )
                        user_emails = user_emails.json()
                        try:
                            user = User.objects.get(email=user_emails[0]["email"])
                            login(req, user)
                            return Response(status=HTTP_200_OK)
                        except User.DoesNotExist:
                            user = User.objects.create(
                                username=user_data.get("login"),
                                email=user_emails[0]["email"],
                                name=user_data.get("login"),
                                profile_photo=user_data.get("avatar_url"),
                            )
                            user.set_unusable_password()
                            # .has_usable_password() if not social login
                            user.save()
                            login(req, user)
                            return Response(status=HTTP_200_OK)
                    except Exception as e:
                        print(e)
                        return Response(
                            status=HTTP_400_BAD_REQUEST,
                        )


        index.ts >
            Remove strict mode to stop page from rendering twice


        GithubConfirm >
            ...imports...
            export default function GithubConfirm() {
            const { search } = useLocation();
            const toast = useToast();
            const QueryClient = useQueryClient();
            const navigate = useNavigate();
            const confirmLogin = async () => {
                const params = new URLSearchParams(search);
                const code = params.get("code");
                if (code) {
                    const status = await githubLogin(code);
                    if (status == 200) {
                        toast({
                            status: "success",
                            title: "Logged In",
                            description: "Welcome back!",
                            position: "bottom-right"
                        });
                        QueryClient.refetchQueries(['me']);
                        navigate("/");
                    } else {
                        toast({
                            status: "error",
                            title: "Error",
                            description: "Something went wrong!",
                            position: "bottom-right"
                        })
                    }
                }
            }

    9. Kakao Talk App - Trying with LINE LATER
 
        PASS

    10. Kakao Talk Auth - Trying with LINE LATER

        PASS

    11. Kakao Login - Trying with LINE LATER

        PASS

    12. Login Form

        NOT RECOMMENDED
            LoginModal > 
                ...
                const [username, onChangeUsername] = useState("");
                const [password, onChangePassword] = useState("");
                const onChange = (e: React.SyntheticEvent<HTMLInputElement>) => {
                    const { name, value } = e.currentTarget;
                    if (name === "username") {
                        onChangeUsername(value)
                        console.log(value);
                    }
                    else if (name === "password") {
                        onChangePassword(value);
                        console.log(value);
                    }
                }
                const onSubmit = (e: React.SyntheticEvent<HTMLFormElement>) => {
                    e.preventDefault();
                    console.log(username, password);
                }
                ...
                <ModalBody as={"form"}>
                    <VStack>
                        <InputGroup>
                            <InputLeftElement children={
                                <Box color={"gray.500"}>
                                    <FaUserNinja />
                                </Box>} />
                            <Input
                                name="username"
                                value={username}
                                required
                                onChange={onChange}
                                placeholder='Username'
                                variant={"filled"} />
                        </InputGroup>
                        <InputGroup>
                            <InputLeftElement children={
                                <Box color={"gray.500"}>
                                    <FaLock />
                                </Box>} />
                            <Input
                                name="password"
                                value={password}
                                type="password"
                                required
                                onChange={onChange}
                                placeholder='Password'
                                variant={"filled"} />
                        </InputGroup>
                    </VStack>
                    <Button
                        type='submit'
                        onSubmit={onSubmit as any}
                        colorScheme={"red"}
                        w={"100%"}
                        mt={4}
                        mb={4}
                    >
                        Login
                    </Button>
                    <SocialLogin />
                </ModalBody>

            THIS IS HOW MUCH CODE JUST FOR USERNAME AND PASSWORD -
            YOU WILL NEED TO WRITE CODE FOR BELOW FOR CREATING A USER
                username, setusername
                pass, set_unusable_password
                email, setemail
                passworderr, setpassworderr,
                emailerr,setemailerr
                ifelses for each of these on change
            NOT RECOMMENDED 
            RECOMMEND REACT HOOK FORM as it saves time

    13. React Hook Form

        DELETED ABOVE (all code above return)
        DELETED NAME, ONCHANGE and VALUE from inputs

        npm i react-hook-form
        import {useForm} from 'react-hook-form';

        ...
        interface ILoginForm {
            username: string;
            password: string;
        }

        function LoginModal({ isOpen, onClose }: LoginModalProps) {
            const { register, handleSubmit, formState: { errors } } = useForm<ILoginForm>();
            // watch, handleForm, formState
            const onSubmit = (data: ILoginForm) => {
                console.log(data);
            }
            return (
                <Modal isOpen={isOpen} onClose={onClose}>
                    <ModalOverlay />
                    <ModalContent>
                        <ModalHeader>Login</ModalHeader>
                        <ModalCloseButton />
                        <ModalBody as={"form"} onSubmit={handleSubmit(onSubmit)}>
                            <VStack>
                                <InputGroup>
                                    <InputLeftElement children={
                                        <Box color={"gray.500"}>
                                            <FaUserNinja />
                                        </Box>} />
                                    <Input
                                        isInvalid={Boolean(errors.password?.message)}
                                        {...register("username", {
                                            required: "Please provide a username",
                                        })}
                                        required
                                        placeholder='Username'
                                        variant={"filled"} />
                                </InputGroup>
                                <InputGroup>
                                    <InputLeftElement children={
                                        <Box color={"gray.500"}>
                                            <FaLock />
                                        </Box>} />
                                    <Input
                                        isInvalid={Boolean(errors.password?.message)}
                                        {...register("password", {
                                            required: "Please provide a password",
                                        })}
                                        required
                                        type="password"
                                        placeholder='Password'
                                        variant={"filled"} />
                                </InputGroup>
                            </VStack>
                            <Button
                                type='submit'
                                colorScheme={"red"}
                                w={"100%"}
                                mt={4}
                                mb={4}
                            >
                                Login
                            </Button>
                            <SocialLogin />
                        </ModalBody>

                    </ModalContent>

                </Modal>)
        }

        export default LoginModal

    14. useMutation

        useQuery vs useMutation

        api >
            export interface IUsernameLoginVariables {
                username: string;
                password: string;
            }

            export interface IUsernameLoginSuccess {
                ok: string;
            }

            export interface IUsernameLoginError {
                error: string;
            }

            export const usernameLogin = ({ username, password }: IUsernameLoginVariables) => instance.post(
                `/users/log-in`,
                { username, password },
                {
                    headers: {
                        "X-CSRFToken": Cookie.get("csrftoken") || "",
                    },
                }
            ).then((res) => res.status);


        LoginModal >
            ...
            function LoginModal({ isOpen, onClose }: LoginModalProps) {
                const { register, handleSubmit, formState: { errors } } = useForm<ILoginForm>(); // Generics could optionally go here (IUSucc,Errr,Variab)
                // watch, handleForm, formState
                const toast = useToast();
                const queryClient = useQueryClient();
                const mutation = useMutation(usernameLogin, {
                    onMutate: () => {
                        console.log("mutation starting");
                    },
                    onSuccess: (data) => {
                        console.log("mutation successful");
                        toast({
                            title: "Welcome back!",
                            status: "success",
                            position: "bottom-right",
                        });
                        onClose();
                        queryClient.refetchQueries(["me"])
                    },
                    onError: (error) => {
                        console.log("mutation failed");
                        toast({
                            title: "Failed",
                            status: "error",
                            position: "bottom-right",
                        })
                    }
                });
                const onSubmit = ({ username, password }: ILoginForm) => {
                    mutation.mutate({ username, password });
                }
                return (
            ...

            ...
            <Button
                isLoading={mutation.isLoading}
                type='submit'
                colorScheme={"red"}
                w={"100%"}
                mt={4}
                mb={4}
            >
                Login
            </Button>
            ...

    15. Recap & Code Challenge 

        Header >
            REFACTOR 

            const toast = useToast();
            const queryClient = useQueryClient();
            const toastId = useRef<ToastId>();
            const mutation = useMutation(logOut, {
                onMutate: () => {
                    toastId.current = toast({
                        title: "Login out...",
                        description: "Sad to see you go...",
                        status: "loading",
                        position: "bottom-right",
                    });
                },
                onSuccess: () => {
                    if (toastId.current) {
                        queryClient.refetchQueries(["me"]);
                        toast.update(toastId.current, {
                            status: "success",
                            title: "Logged Out",
                            description: "You have successfully logged out",
                        });
                    }
                },
            });
            const onLogOut = async () => {
                mutation.mutate();
            }
    
        Api >
            export const usernameLogin = ({ username, password }: IUsernameLoginVariables) =>
            instance.post(
                `/users/log-in`,
                { username, password },
                {
                    headers: {
                        "X-CSRFToken": Cookie.get("csrftoken") || "",
                    },
                }
            );

        LoginModal >
            function LoginModal({ isOpen, onClose }: LoginModalProps) {
                const { register, handleSubmit, formState: { errors }, reset } = useForm<ILoginForm>(); // Generics could optionally go here (IUSucc,Errr,Variab)
                // watch, handleForm, formState
                const toast = useToast();
                const queryClient = useQueryClient();
                const mutation = useMutation(usernameLogin, {
                    // onMutation - unused
                    onSuccess: (data) => {
                        console.log("mutation successful");
                        toast({
                            title: "Welcome back!",
                            status: "success",
                            position: "bottom-right",
                        });
                        onClose();
                        reset();
                        queryClient.refetchQueries(["me"])
                    },
                    onError: (error) => {
                        console.log("mutation failed");
                        toast({
                            title: "Failed",
                            status: "error",
                            position: "bottom-right",
                        })
                    }
                });
                const onSubmit = ({ username, password }: ILoginForm) => {
                    mutation.mutate({ username, password });
                };

        CHALLENGE = MAKE SIGN UP FORM           - AFTER
        REFACTOR GH/LINE FORM TO USE USEMUTATION     - AFTER


-------------------------------------------------------------------------

21. UPLOAD ROOM

    1. Protected Pages

        COMPONENT PROTECTION WAY

        routes.UploadRoom.tsx >
            import HostOnlyPage from "../components/HostOnlyPage";
            import ProtectedPage from "../components/ProtectedPage";

            function UploadRoom() {
                return (
                    <ProtectedPage>
                        <HostOnlyPage>
                            <div>UploadRoom</div>
                        </HostOnlyPage>
                    </ProtectedPage>
                )
            }

            export default UploadRoom

        router >
            Add above rooms/:roomPl (RoomDetail Component child)
        {
            path: "rooms/upload",
            element: <UploadRoom />,
        },

        Header >
            {userData?.is_host ?
                <Link to="/rooms/upload"><MenuItem>Upload Room</MenuItem></Link>
                :
                null
            }

        components.ProtectedPage >
            import React, { useEffect } from 'react'
            import { useNavigate } from 'react-router-dom';
            import useUser from '../lib/useUser'

            interface IProtectedPageProps {
                children: React.ReactNode
            }

            function ProtectedPage({ children }: IProtectedPageProps) {
                const { userData, isLoggedIn, userLoading } = useUser();
                const navigate = useNavigate();
                useEffect(() => {
                    if (!userLoading) {
                        if (!isLoggedIn) {
                            navigate("/");
                        }
                    }
                }, [userLoading, isLoggedIn, navigate])
                return (
                    <>{children}</>
                )
            }

            export default ProtectedPage


        components.HostOnlyPage.tsx >
            import React, { useEffect } from 'react'
            import { useNavigate } from 'react-router-dom';
            import useUser from '../lib/useUser'

            interface IHostOnlyPageProps {
                children: React.ReactNode
            }

            function HostOnlyPage({ children }: IHostOnlyPageProps) {
                const { userData, userLoading } = useUser();
                const navigate = useNavigate();
                useEffect(() => {
                    if (!userLoading) {
                        if (!userData?.is_host) {
                            navigate("/");
                        }
                    }
                }, [userLoading, userData, navigate])
                return (
                    <>{children}</>
                )
            }

            export default HostOnlyPage
            

        OR ====================
        USEPROTECTEDPAGE && USEHOSTONLYPAGE HOOK WAY

        // Can use component or useHook.. both styles present here. (protectedpage -component,
        // hostonlypage would be nested inside but is now hook)
        function useHostOnlyPage() {
            const { userData, userLoading } = useUser();
            const navigate = useNavigate();
            useEffect(() => {
                if (!userLoading) {
                    if (!userData?.is_host) {
                        navigate("/");
                    }
                }
            }, [userLoading, userData, navigate])
            return;
        }

        export default useHostOnlyPage


    2. Upload Form

        Chakra Upload Room tsx Form

    3. Dynamic Form


    4. register

        register is how we connect inputs with react state

        First step is explaining to typescript how data for rooms looks:
        
        UploadRoom >
            interface IForm {
                name: string;
                country: string;
                city: string;
                price: number;
                rooms: number;
                toilets: number;
                description: string;
                address: string;
                pet_friendly: boolean;
                kind: string;
                amenities: number[];
                category: number;
            }

            export default function UploadRoom() {
                const {register, handleSubmit} = useForm<IForm>();
                ...
                <Input {...register("name", { required: true })} required type="text" />
                ...
                <Input {...register("country", {required:true})} required type="text" />
                ...
                <Input {...register("city", {required:true})} required type="text" />
                ...
                <Input {...register("address", {required:true})} required type="text" />
                ...
                <Input {...register("price", {required:true})} type="number" min={0} />
                ...
                <Input {...register("rooms", {required:true})} type="number" min={0} />
                ...
                <Input {...register("toilets", {required:true})} type="number" min={0} />
                ...
                <Textarea {...register("description", {required:true})} />
                ...
                <Checkbox {...register("pet_friendly", {required:true})}>Pet friendly?</Checkbox>
                ...
                <Select {...register("kind", {required:true})} placeholder="Choose a kind">
                ...
                <Select {...register("category", {required:true})} placeholder="Choose a category">
                ...
                <Checkbox value={amenity.pk} {...register("amenities", {required:true})}>{amenity.name}</Checkbox>

    // Use console.log(watch()); to ensure data is appropriate form

        const { register, handleSubmit } = useForm<IForm>();
        const toast = useToast();
        const mutation = useMutation(uploadRoom, {
            onSuccess: () => {
                toast({
                    status: "success",
                    title: "Room created",
                    position: "bottom-right",
                })
            },
        });
        ...
        const onSubmit = (data:IUploadRoomVariables) => {
            mutation.mutate(data);
        }
        ...
        <VStack spacing={10} as="form" onSubmit={handleSubmit(onSubmit)} mt={5}>
        
    // Reorder interface to API and import into upload room
        api >
            export interface IUploadRoomVariables {
            name: string;
            country: string;
            city: string;
            price: number;
            rooms: number;
            toilets: number;
            description: string;
            address: string;
            pet_friendly: boolean;
            kind: string;
            amenities: number[];
            category: number;
        }


        export const uploadRoom = (variables: IUploadRoomVariables) =>
            instance.post(
                `/rooms`,
                variables,
                {
                    headers: {
                        "X-CSRFToken": Cookie.get("csrftoken") || "",
                    },
                }
            );

        UploadRoom >

            ...
            {mutation.isError ?
                <Text
                    color={"red.500"}
                >
                    Something went wrong
                </Text> :
                null
            }
            <Button isLoading={mutation.isLoading} type="submit" colorScheme={"red"} size="lg" w="100%">

        CategorySerializer >
            remove pk from exclude

    5. Bugfix

        rooms.views.Rooms.post >
            add 
            ...
                roomdetaiserializer(
                    room,
                    context={"request":request}
                )
                return Response(serializer.data)
            ...            


        types.d.ts >
            export interface IRoomDetail extends IRoomList {
                id: number;
                created_at: string;
                updated_at: string;
                rooms: number;
                toilets: number;
                description: string;
                address: string;
                pet_friendly: true;
                kind: string;
                is_owner: boolean;
                is_liked: boolean;
                category: ICategory;
                owner: IRoomOwner;
                amenities: IAmenity[];
            }

            export interface IAmenity {
                pk: number;
                name: string;
                description: string;
            }

            export interface ICategory {
                id: number;
                name: string;
                kind: string;
            }

        UploadRoom >
            const navigate = useNavigate();
            const mutation = useMutation(uploadRoom, {
                onSuccess: (data:IRoomDetail) => {
                    toast({
                        status: "success",
                        title: "Room created",
                        position: "bottom-right",
                    });
                    navigate(`/rooms/${data.id}`)
                },
            });

        Should navigate to a 'page not found' due to error with trying to show
        pictures, when room has no pictures.
        Fixed like so:

        RoomDetail >
        ...line 37ish
            <GridItem
                colSpan={index === 0 ? 2 : 1}
                rowSpan={index === 0 ? 2 : 1}
                overflow={"hidden"}
                key={index}>
                <Skeleton
                    isLoaded={!isLoading} h="100%" w="100%"
                >
                    {data?.photos && data.photos.length > 0 ?
                    (<Image src={data?.photos[index].file} w={"100%"} h={"100%"} objectFit={"cover"} />) : 
                    null}

                </Skeleton>
            </GridItem>)

    6. Upload Form


        Home >
            Add to room mapping
            isOwner={room.is_owner}

        Room >
            IRoomProps 
                isOwner: boolean;

            ...
            function Room({ pk, name, imageURL, rating, city, country, price, isOwner }: IRoomProps) {
            ...
            const navigate = useNavigate();
            const onCameraClick = (e: React.SyntheticEvent<HTMLButtonElement>) => {
                e.preventDefault();
                navigate(`/rooms/${pk}/photos`)
            }
            const onHeartClick = (e: React.SyntheticEvent<HTMLButtonElement>) => {
                e.preventDefault();
            }
            ...
        (Heart area)
            {isOwner ? <FaCamera size={20}/> : <FaRegHeart size={20} />}


        rfce UploadPhotos
        router - under rooms/:roomPk >
            {
                path: "rooms/:roomPk/photos",
                element: <UploadPhotos />,
            },

        UploadPhotos >
            import {
                Box,
                Button,
                Container,
                FormControl,
                Heading,
                Input,
                VStack,
            } from "@chakra-ui/react";
            import { useForm } from "react-hook-form";
            import { useParams } from "react-router-dom";
            import useHostOnlyPage from "../components/HostOnlyPage";
            import ProtectedPage from "../components/ProtectedPage";

            export default function UploadPhotos() {
                const { register, watch } = useForm();
                const { roomPk } = useParams();
                useHostOnlyPage();
                return (
                    <ProtectedPage>
                        <Box
                            pb={40}
                            mt={10}
                            px={{
                                base: 10,
                                lg: 40,
                            }}
                        >
                            <Container>
                                <Heading textAlign={"center"}>Upload a Photo</Heading>
                                <VStack spacing={5} mt={10}>
                                    <FormControl>
                                        <Input {...register("file")} type="file" accept="image/*" />
                                    </FormControl>
                                    <Button w="full" colorScheme={"red"}>
                                        Upload photos
                                    </Button>
                                </VStack>
                            </Container>
                        </Box>
                    </ProtectedPage>
                );
            }


    7. One-Time Upload

        Cloudflare Images After paying -

        dash.cloudflare.com/profile/api-tokens
            create token > Read and write to Cloudflare Stream and Images >
            continue to summary > create token 
        copy token to django .env >
            CF_IMAGES_TOKEN="STRINGHERE"

        dash.cloudflare.com/profile/api-tokens
        Developer Resources - copy Account ID to .env>
            CF_ID="PASTESTRINGHERE"

        conf.settings >
            CF_ID = env("CF_ID)
            CF_IMAGES_TOKEN = env("CF_IMAGES_TOKEN)

        https://developers.cloudflare.com/images/cloudflare-images/upload-images/upload-via-url/
        
        Django medias.urls >
            path("photos/get-url", views.GetUploadURL.as_view),

        medias.views >
            from django.conf import settings
            import requests
            ...
            

            class GetUploadURL(APIView):
                def post(self, req):
                    # f"https://api.cloudflare.com/client/v4/accounts/{settings.CF_ID}/images/v1"

                    url = f"https://api.cloudflare.com/client/v4/accounts/{settings.CF_ID}/images/v2/direct_upload"
                    one_time_url = requests.post(
                        url,
                        headers={
                            "Authorization": f"Bearer {settings.CF_IMAGES_TOKEN}",
                            # "Content-Type": "multipart/form-data",
                        },
                    )
                    one_time_url = one_time_url.json()
                    result = one_time_url.get("result")
                    return Response(
                        {
                            "uploadURL": result.get("uploadURL"),
                        }
                    )


        api.tsx >
            export const getUploadURL = () =>
                instance.post(`medias/photos/get-url`, null, 
                {
                    headers: {
                        "X-CSRFToken": Cookie.get("csrftoken") || "",
                    },
                }
            ).then((res) => res.data);

        UploadPhotos.tsx >
            ...imports
            interface IForm {
                file: FileList;
            }

            export default function UploadPhotos() {
                const { register, handleSubmit } = useForm<IForm>();
                const mutation = useMutation(getUploadURL, {
                onSuccess: (data: any) => {
                    console.log(data);
                },
                });
                ...
                const onSubmit = (data: any) => {
                    mutation.mutate();
                };
                ...
                <VStack
                    as="form"
                    onSubmit={handleSubmit(onSubmit)}
                    spacing={5}
                    mt={10}
                >
                ...
                <Button type="submit" w="full" colorScheme={"red"}>
                    Upload photos
                </Button>    

    8. File Upload

        use returned uploadURL to actually upload

        api >
            export interface IUploadImageVarialbes {
                file: FileList;
                uploadURL: string;
            }

            export const uploadImage = ({ file, uploadURL }: IUploadImageVarialbes) => {
                const form = new FormData();
                form.append("file", file[0]);
                return axios
                    .post(uploadURL, form, {
                        headers: {
                            "Content-Type": "multipart/form-data",
                        },
                    })
                    .then((response) => response.data);
            };

        UploadRoom >
        import { getUploadURL, uploadImage } from "../api";
..

            interface IUploadURLResponse {
                id: string;
                uploadURL: string;
            }
            export default function UploadPhotos() {
                const { register, handleSubmit, watch } = useForm<IForm>();
                const { roomPk } = useParams();
                const uploadImageMutation = useMutation(uploadImage, {
                    onSuccess: (data: any) => {
                        console.log(data);
                    },
                });
                const uploadURLMutation = useMutation(getUploadURL, {
                    onSuccess: (data: IUploadURLResponse) => {
                        uploadImageMutation.mutate({
                            uploadURL: data.uploadURL,
                            file: watch("file"),
                        });
                    },
                });

                useHostOnlyPage();
                const onSubmit = () => {
                    uploadURLMutation.mutate();
                };
                ...

    9. Final Mutation

        api >
            export interface ICreatePhotoVariables {
            description: string;
            file: string;
            roomPk: string;
            }

            export const createPhoto = ({
            description,
            file,
            roomPk,
            }: ICreatePhotoVariables) =>
            instance
                .post(
                `rooms/${roomPk}/photos`,
                { description, file },
                {
                    headers: {
                    "X-CSRFToken": Cookie.get("csrftoken") || "",
                    },
                }
                )
                .then((response) => response.data);

        Upload Photos >
        ...
            export default function UploadPhotos() {
                const { register, handleSubmit, watch, reset } = useForm<IForm>();
                const { roomPk } = useParams();
                const toast = useToast();
                const createPhotoMutation = useMutation(createPhoto, {
                    onSuccess: () => {
                        toast({
                            status: "success",
                            title: "Image uploaded!",
                            isClosable: true,
                            description: "Feel free to upload more images.",
                        });
                        reset();
                    },
                });
                const uploadImageMutation = useMutation(uploadImage, {
                    onSuccess: ({ result }: any) => {
                        if (roomPk) {
                            createPhotoMutation.mutate({
                                description: "I love react",
                                file: `https://imagedelivery.net/-s4B0ZsrNIjJGDRj2C5RxQ/${result.id}/public`,
                                roomPk,
                            });
                        }
                    },
                });
                const uploadURLMutation = useMutation(getUploadURL, {
                    onSuccess: (data: IUploadURLResponse) => {
                        uploadImageMutation.mutate({
                            uploadURL: data.uploadURL,
                            file: watch("file"),
                        });
                    },
                });
                useHostOnlyPage();
                const onSubmit = () => {
                    uploadURLMutation.mutate();
                };

        ...
            <Button
              isLoading={
                createPhotoMutation.isLoading ||
                uploadImageMutation.isLoading ||
                uploadURLMutation.isLoading
              }
              type="submit"
              w="full"
              colorScheme={"red"}
            >
                Upload photos
            </Button>


            -s4B0ZsrNIjJGDRj2C5RxQ is the hash of accountID
            (WILL CHANGE PER ACCOUNT)

        IN DJANGO > Fix photos being returned as just ID by 
        adding photos = PhotoSerializer(many=True, read_only=True)


            class RoomListSerializer(ModelSerializer):

                rating = serializers.SerializerMethodField()
                is_owner = serializers.SerializerMethodField()
                photos = PhotoSerializer(many=True, read_only=True)

                class Meta:
                    model = Room
                    fields = [
                        "pk",
                        "name",
                        "country",
                        "city",
                        "price",
                        "rating",
                        "is_owner",
                        "photos",
                    ]

                def get_is_owner(self, room):
                    req = self.context["request"]
                    return room.owner == req.user

                def get_rating(self, room):
                    return room.rating()


-------------------------------------------------------------------------

22. CALENDAR


    1. Calendar Component


    2. Booking Dates


    3. Checking Dates


    4. Timezones


    5. Code Challenge

-------------------------------------------------------------------------

23. DEPLOYMENT

    1. Render Blueprint


    2. Sentry


    3. Custom Domain


    4. Rewrites


    5. Conclusions

-------------------------------------------------------------------------




==========================================================================
==========================================================================
    9. Kakao Talk App - Trying with LINE LATER
        https://developers.line.biz/en/reference/line-login/#oauth
        https://api.line.me/oauth2/v2.1/token

        curl -v -X POST https://api.line.me/oauth2/v2.1/token \
        -H 'Content-Type: application/x-www-form-urlencoded' \
        -d 'grant_type=authorization_code' \
        -d 'code=1234567890abcde' \
        --data-urlencode 'redirect_uri=https://example.com/auth?key=value' \
        -d 'client_id=1234567890' \
        -d 'client_secret=1234567890abcdefghij1234567890ab' \
        -d 'code_verifier=wJKN8qz5t8SSI9lMFhBB6qwNkQBkuPZoCxzRhwLRUo1'

    10. Kakao Talk Auth


    11. Kakao Login
